<!DOCTYPE html>
<!--
Copyright 2013 The Polymer Authors. All rights reserved.
Use of this source code is governed by a BSD-style
license that can be found in the LICENSE file.
-->
<title>WeakMap tests</title>
<meta charset="UTF8">
<!-- Mocha -->
<link rel="stylesheet" href="../node_modules/mocha/mocha.css">
<script src="../node_modules/mocha/mocha.js"></script>
<!-- Chai -->
<script src="../node_modules/chai/chai.js"></script>
<!-- WeakMap -->
<script src="../weakmap.js"></script>
<!-- Test Setup -->
<div id="mocha"></div>
<script>
  mocha.setup({
    ui: 'tdd',
    slow: 1000
  });
</script>
<!-- Tests -->
<script>
  suite('WeakMap', function() {

    var expect = chai.expect;

    test('WeakMap has get, set, delete, and has properties', function() {
      expect(WeakMap.prototype).to.have.property('get');
      expect(WeakMap.prototype).to.have.property('set');
      expect(WeakMap.prototype).to.have.property('delete');
      expect(WeakMap.prototype).to.have.property('has');
    });

    test('WeakMap\'s methods perform as expected', function() {
      var wm = new WeakMap();

      var o1 = {};
      var o2 = function(){};
      var o3 = window;

      wm.set(o1, 37);
      wm.set(o2, 'aoeui');

      expect(wm.get(o1)).to.equal(37);
      expect(wm.get(o2)).to.equal('aoeui');

      wm.set(o1, o2);
      wm.set(o3, undefined);

      expect(wm.get(o1)).to.equal(o2);
      expect(wm.get({})).to.equal(undefined); // undefined, because there is no value for the object on wm
      expect(wm.get(o3)).to.equal(undefined); // undefined, because that is the set value

      expect(wm.has(o1)).to.equal(true);
      expect(wm.has({})).to.equal(false);

      wm.delete(o1);
      expect(wm.get(o1)).to.equal(undefined);
      expect(wm.has(o1)).to.equal(false);
      // Ensure that delete returns true/false indicating if the value was removed
      expect(wm.delete(o2)).to.equal(true);
      expect(wm.delete({})).to.equal(false);
    });
  });
</script>
<!-- Run Mocha -->
<script>
  mocha.run();
</script>
